#!/bin/bash

# set offset based on number of arguments
offset="+0day"
if [ $# -ge 1 ]; then
	offset="$1day"
fi

# path to directory of lists
if ! [ -d "$tdir" ]; then
	tdir="$HOME/Documents/todo-lists"
fi

# make directories recursively
tpath="$tdir/lists/$(date --date $offset +%Y)/$(date --date $offset +%m)"
mkdir -p $tpath

# if not in a tmux pane, either attaches or creates session with name tdl
if [ -z ${TMUX+x} ]; then
	tmux new -A -s tdl -c $tdir
else 
	# getting path + name of list
	filename="${tpath}/$(date --date $offset +%F).md"
	# update git repo
	cd "${tpath}" && git pull
	
	# checking if file exists
	if ! [ -f "${filename}" ]; then
		touch ${filename}
		echo "# To Do List $(date --date $offset +'%A %F')" > "${filename}"
		cat "${tdir}/header.md" >> "${filename}"
	fi

	vim "${filename}"
	
	# janky git adding tdl file, all non-list files
	git add "${tdir}"
	git restore --staged "${tdir}/lists"
	git add "${filename}"
	git commit -m "updated $(date --date $offset +%F).md"
	git push
fi
